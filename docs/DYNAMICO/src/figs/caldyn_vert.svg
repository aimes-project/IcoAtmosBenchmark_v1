<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.0//EN'
          'http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd'>
<svg stroke-dasharray="none" shape-rendering="auto" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" font-family="'Dialog'" text-rendering="auto" width="1039" fill-opacity="1" color-interpolation="auto" color-rendering="auto" font-size="12px" viewBox="0 0 1039 840" fill="black" xmlns:xlink="http://www.w3.org/1999/xlink" stroke="black" image-rendering="auto" stroke-miterlimit="10" stroke-linecap="square" stroke-linejoin="miter" font-style="normal" stroke-width="1" height="840" stroke-dashoffset="0" font-weight="normal" stroke-opacity="1"
><!--Generated by the Batik Graphics2D SVG Generator--><defs id="genericDefs"
  /><g
  ><g fill="white" text-rendering="geometricPrecision" stroke-width="2" font-size="14px" font-family="sans-serif" stroke="white"
    ><rect x="10" y="10" width="399" rx="24" ry="16" height="38" stroke="none"
      /><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="28" stroke="none"
      >subroutine compute_caldyn_vert</text
      ><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="42" stroke="none"
      >(u,theta,rhodz,convm, wflux,wwuu, dps,dtheta_rhodz,du)</text
      ><rect x="10" y="10" fill="none" width="399" rx="24" ry="16" height="38" stroke="rgb(51,51,51)"
      /><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="76" stroke="none"
      >(cumulate mass flux convergence from top to bottom)</text
      ><rect x="395.1055" width="284.0576" height="24" y="92" stroke="none"
      /><text fill="rgb(51,51,51)" x="410.1055" xml:space="preserve" y="110" stroke="none"
      >convm(ij,l) = convm(ij,l) + convm(ij,l+1)</text
      ><rect fill="none" x="395.1055" width="284.0576" height="24" y="92" stroke="rgb(51,51,51)"
      /><line y2="92" fill="none" x1="380.1055" x2="395.1055" stroke="rgb(51,51,51)" y1="92"
      /><rect x="156.3486" width="223.7568" height="24" y="92" stroke="none"
      /><text fill="rgb(51,51,51)" x="181.3486" xml:space="preserve" y="110" stroke="none"
      >ij=ij_omp_begin,ij_omp_end</text
      ><rect fill="none" x="156.3486" width="223.7568" height="24" y="92" stroke="rgb(51,51,51)"
      /><line y2="116" fill="none" x1="166.3486" x2="166.3486" stroke="rgb(51,51,51)" y1="92"
      /><line y2="92" fill="none" x1="141.3486" x2="156.3486" stroke="rgb(51,51,51)" y1="92"
      /><rect x="10" width="131.3486" height="24" y="92" stroke="none"
      /><text fill="rgb(51,51,51)" x="35" xml:space="preserve" y="110" stroke="none"
      >l = llm-1, 1, -1</text
      ><rect fill="none" x="10" width="131.3486" height="24" y="92" stroke="rgb(51,51,51)"
      /><line y2="116" fill="none" x1="20" x2="20" stroke="rgb(51,51,51)" y1="92"
      /><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="144" stroke="none"
      >(compute dps)</text
      ><text fill="rgb(51,51,51)" x="438.3936" xml:space="preserve" y="178" stroke="none"
      >(dps/dt = -int(div flux)dz)</text
      ><rect x="423.3936" width="180.6025" height="24" y="194" stroke="none"
      /><text fill="rgb(51,51,51)" x="438.3936" xml:space="preserve" y="212" stroke="none"
      >dps(ij) = convm(ij,1) * g</text
      ><rect fill="none" x="423.3936" width="180.6025" height="24" y="194" stroke="rgb(51,51,51)"
      /><line y2="218" fill="none" x1="423.3936" x2="423.3936" stroke="rgb(51,51,51)" y1="160"
      /><line y2="160" fill="none" x1="408.3936" x2="423.3936" stroke="rgb(51,51,51)" y1="160"
      /><rect x="257.3301" width="151.0635" height="24" y="160" stroke="none"
      /><text fill="rgb(51,51,51)" x="282.3301" xml:space="preserve" y="178" stroke="none"
      >ij=ij_begin,ij_end</text
      ><rect fill="none" x="257.3301" width="151.0635" height="24" y="160" stroke="rgb(51,51,51)"
      /><line y2="184" fill="none" x1="267.3301" x2="267.3301" stroke="rgb(51,51,51)" y1="160"
      /><line y2="160" fill="none" x1="242.3301" x2="257.3301" stroke="rgb(51,51,51)" y1="160"
      /><polygon points=" 10 160 242 160 202 194 242 228 10 228" stroke="none"
      /><text fill="rgb(51,51,51)" x="183.5498" xml:space="preserve" y="178" stroke="none"
      > </text
      ><text fill="rgb(51,51,51)" x="179.7695" xml:space="preserve" y="222" stroke="none"
      >  </text
      ><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="200" stroke="none"
      >(is_omp_first_level)</text
      ><polygon fill="none" points=" 10 160 242 160 202 194 242 228 10 228" stroke="rgb(51,51,51)"
      /><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="256" stroke="none"
      >(Compute vertical mass flux (l=1,llm+1 done by caldyn_BC))</text
      ><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="290" stroke="none"
      >(w = int(z,ztop,div(flux)dz) + B(eta)dps/dt </text
      ><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="304" stroke="none"
      > =&gt; w&gt;0 for upward transport)</text
      ><rect x="355.8604" width="335.3203" height="24" y="320" stroke="none"
      /><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="338" stroke="none"
      >wflux( ij, l ) = bp(l) * convm( ij, 1 ) - convm( ij, l )</text
      ><rect fill="none" x="355.8604" width="335.3203" height="24" y="320" stroke="rgb(51,51,51)"
      /><line y2="344" fill="none" x1="355.8604" x2="355.8604" stroke="rgb(51,51,51)" y1="272"
      /><line y2="272" fill="none" x1="340.8604" x2="355.8604" stroke="rgb(51,51,51)" y1="272"
      /><rect x="189.7969" width="151.0635" height="24" y="272" stroke="none"
      /><text fill="rgb(51,51,51)" x="214.7969" xml:space="preserve" y="290" stroke="none"
      >ij=ij_begin,ij_end</text
      ><rect fill="none" x="189.7969" width="151.0635" height="24" y="272" stroke="rgb(51,51,51)"
      /><line y2="296" fill="none" x1="199.7969" x2="199.7969" stroke="rgb(51,51,51)" y1="272"
      /><line y2="272" fill="none" x1="174.7969" x2="189.7969" stroke="rgb(51,51,51)" y1="272"
      /><rect x="10" width="164.7969" height="24" y="272" stroke="none"
      /><text fill="rgb(51,51,51)" x="35" xml:space="preserve" y="290" stroke="none"
      >l=ll_beginp1,ll_end</text
      ><rect fill="none" x="10" width="164.7969" height="24" y="272" stroke="rgb(51,51,51)"
      /><line y2="296" fill="none" x1="20" x2="20" stroke="rgb(51,51,51)" y1="272"
      /><rect x="359.3604" width="484.8838" height="38" y="354" stroke="none"
      /><text fill="rgb(51,51,51)" x="374.3604" xml:space="preserve" y="372" stroke="none"
      >dtheta_rhodz(ij, l ) </text
      ><text fill="rgb(51,51,51)" x="374.3604" xml:space="preserve" y="386" stroke="none"
      >= dtheta_rhodz(ij, l )  -   0.5 * (  wflux(ij,l+1) * (theta(ij,l) + theta(ij,l+1)))</text
      ><rect fill="none" x="359.3604" width="484.8838" height="38" y="354" stroke="rgb(51,51,51)"
      /><line y2="354" fill="none" x1="344.3604" x2="359.3604" stroke="rgb(51,51,51)" y1="354"
      /><rect x="193.2969" width="151.0635" height="24" y="354" stroke="none"
      /><text fill="rgb(51,51,51)" x="218.2969" xml:space="preserve" y="372" stroke="none"
      >ij=ij_begin,ij_end</text
      ><rect fill="none" x="193.2969" width="151.0635" height="24" y="354" stroke="rgb(51,51,51)"
      /><line y2="378" fill="none" x1="203.2969" x2="203.2969" stroke="rgb(51,51,51)" y1="354"
      /><line y2="354" fill="none" x1="178.2969" x2="193.2969" stroke="rgb(51,51,51)" y1="354"
      /><rect x="10" width="168.2969" height="24" y="354" stroke="none"
      /><text fill="rgb(51,51,51)" x="35" xml:space="preserve" y="372" stroke="none"
      >l=ll_begin,ll_endm1</text
      ><rect fill="none" x="10" width="168.2969" height="24" y="354" stroke="rgb(51,51,51)"
      /><line y2="378" fill="none" x1="20" x2="20" stroke="rgb(51,51,51)" y1="354"
      /><rect x="355.8604" width="478.5879" height="38" y="402" stroke="none"
      /><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="420" stroke="none"
      >dtheta_rhodz(ij, l ) </text
      ><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="434" stroke="none"
      >= dtheta_rhodz(ij, l )  +   0.5 * ( wflux(ij,l  ) * (theta(ij,l-1) + theta(ij,l) ) )</text
      ><rect fill="none" x="355.8604" width="478.5879" height="38" y="402" stroke="rgb(51,51,51)"
      /><line y2="402" fill="none" x1="340.8604" x2="355.8604" stroke="rgb(51,51,51)" y1="402"
      /><rect x="189.7969" width="151.0635" height="24" y="402" stroke="none"
      /><text fill="rgb(51,51,51)" x="214.7969" xml:space="preserve" y="420" stroke="none"
      >ij=ij_begin,ij_end</text
      ><rect fill="none" x="189.7969" width="151.0635" height="24" y="402" stroke="rgb(51,51,51)"
      /><line y2="426" fill="none" x1="199.7969" x2="199.7969" stroke="rgb(51,51,51)" y1="402"
      /><line y2="402" fill="none" x1="174.7969" x2="189.7969" stroke="rgb(51,51,51)" y1="402"
      /><rect x="10" width="164.7969" height="24" y="402" stroke="none"
      /><text fill="rgb(51,51,51)" x="35" xml:space="preserve" y="420" stroke="none"
      >l=ll_beginp1,ll_end</text
      ><rect fill="none" x="10" width="164.7969" height="24" y="402" stroke="rgb(51,51,51)"
      /><line y2="426" fill="none" x1="20" x2="20" stroke="rgb(51,51,51)" y1="402"
      /><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="468" stroke="none"
      >(Compute vertical transport)</text
      ><rect x="355.8604" width="495.5068" height="38" y="484" stroke="none"
      /><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="502" stroke="none"
      >wwuu(ij+u_right,l) </text
      ><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="516" stroke="none"
      >= 0.5*( wflux(ij,l) + wflux(ij+t_right,l)) * x(u(ij+u_right,l) - u(ij+u_right,l-1))</text
      ><rect fill="none" x="355.8604" width="495.5068" height="38" y="484" stroke="rgb(51,51,51)"
      /><rect x="355.8604" width="465.0049" height="38" y="532" stroke="none"
      /><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="550" stroke="none"
      >wwuu(ij+u_lup,l)   </text
      ><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="564" stroke="none"
      >= 0.5* ( wflux(ij,l) + wflux(ij+t_lup,l)) * (u(ij+u_lup,l) - u(ij+u_lup,l-1))</text
      ><rect fill="none" x="355.8604" width="465.0049" height="38" y="532" stroke="rgb(51,51,51)"
      /><rect x="355.8604" width="518.2979" height="38" y="580" stroke="none"
      /><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="598" stroke="none"
      >wwuu(ij+u_ldown,l) </text
      ><text fill="rgb(51,51,51)" x="370.8604" xml:space="preserve" y="612" stroke="none"
      >= 0.5*( wflux(ij,l) + wflux(ij+t_ldown,l)) * (u(ij+u_ldown,l) - u(ij+u_ldown,l-1))</text
      ><rect fill="none" x="355.8604" width="518.2979" height="38" y="580" stroke="rgb(51,51,51)"
      /><line y2="618" fill="none" x1="355.8604" x2="355.8604" stroke="rgb(51,51,51)" y1="484"
      /><line y2="484" fill="none" x1="340.8604" x2="355.8604" stroke="rgb(51,51,51)" y1="484"
      /><rect x="189.7969" width="151.0635" height="24" y="484" stroke="none"
      /><text fill="rgb(51,51,51)" x="214.7969" xml:space="preserve" y="502" stroke="none"
      >ij=ij_begin,ij_end</text
      ><rect fill="none" x="189.7969" width="151.0635" height="24" y="484" stroke="rgb(51,51,51)"
      /><line y2="508" fill="none" x1="199.7969" x2="199.7969" stroke="rgb(51,51,51)" y1="484"
      /><line y2="484" fill="none" x1="174.7969" x2="189.7969" stroke="rgb(51,51,51)" y1="484"
      /><rect x="10" width="164.7969" height="24" y="484" stroke="none"
      /><text fill="rgb(51,51,51)" x="35" xml:space="preserve" y="502" stroke="none"
      >l=ll_beginp1,ll_end</text
      ><rect fill="none" x="10" width="164.7969" height="24" y="484" stroke="rgb(51,51,51)"
      /><line y2="508" fill="none" x1="20" x2="20" stroke="rgb(51,51,51)" y1="484"
      /><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="646" stroke="none"
      >(Add vertical transport to du)</text
      ><rect x="338.3467" width="634.9463" height="38" y="662" stroke="none"
      /><text fill="rgb(51,51,51)" x="353.3467" xml:space="preserve" y="680" stroke="none"
      >du(ij+u_right, l )   </text
      ><text fill="rgb(51,51,51)" x="353.3467" xml:space="preserve" y="694" stroke="none"
      >= du(ij+u_right,l)  - (wwuu(ij+u_right,l+1)+ wwuu(ij+u_right,l)) / (rhodz(ij,l)+rhodz(ij+t_right,l))</text
      ><rect fill="none" x="338.3467" width="634.9463" height="38" y="662" stroke="rgb(51,51,51)"
      /><rect x="338.3467" width="621.042" height="38" y="710" stroke="none"
      /><text fill="rgb(51,51,51)" x="353.3467" xml:space="preserve" y="728" stroke="none"
      >du(ij+u_lup, l )     </text
      ><text fill="rgb(51,51,51)" x="353.3467" xml:space="preserve" y="742" stroke="none"
      >= du(ij+u_lup,l)    - (wwuu(ij+u_lup,l+1)  + wwuu(ij+u_lup,l))   / (rhodz(ij,l)+rhodz(ij+t_lup,l))</text
      ><rect fill="none" x="338.3467" width="621.042" height="38" y="710" stroke="rgb(51,51,51)"
      /><rect x="338.3467" width="674.458" height="38" y="758" stroke="none"
      /><text fill="rgb(51,51,51)" x="353.3467" xml:space="preserve" y="776" stroke="none"
      >du(ij+u_ldown, l )   </text
      ><text fill="rgb(51,51,51)" x="353.3467" xml:space="preserve" y="790" stroke="none"
      >= du(ij+u_ldown,l)  - (wwuu(ij+u_ldown,l+1)+ wwuu(ij+u_ldown,l)) / (rhodz(ij,l)+rhodz(ij+t_ldown,l))</text
      ><rect fill="none" x="338.3467" width="674.458" height="38" y="758" stroke="rgb(51,51,51)"
      /><line y2="796" fill="none" x1="338.3467" x2="338.3467" stroke="rgb(51,51,51)" y1="662"
      /><line y2="662" fill="none" x1="323.3467" x2="338.3467" stroke="rgb(51,51,51)" y1="662"
      /><rect x="172.2832" width="151.0635" height="24" y="662" stroke="none"
      /><text fill="rgb(51,51,51)" x="197.2832" xml:space="preserve" y="680" stroke="none"
      >ij=ij_begin,ij_end</text
      ><rect fill="none" x="172.2832" width="151.0635" height="24" y="662" stroke="rgb(51,51,51)"
      /><line y2="686" fill="none" x1="182.2832" x2="182.2832" stroke="rgb(51,51,51)" y1="662"
      /><line y2="662" fill="none" x1="157.2832" x2="172.2832" stroke="rgb(51,51,51)" y1="662"
      /><rect x="10" width="147.2832" height="24" y="662" stroke="none"
      /><text fill="rgb(51,51,51)" x="35" xml:space="preserve" y="680" stroke="none"
      >l=ll_begin,ll_end</text
      ><rect fill="none" x="10" width="147.2832" height="24" y="662" stroke="rgb(51,51,51)"
      /><line y2="686" fill="none" x1="20" x2="20" stroke="rgb(51,51,51)" y1="662"
      /><rect x="10" y="806" width="199" rx="24" ry="16" height="24" stroke="none"
      /><text fill="rgb(51,51,51)" x="25" xml:space="preserve" y="824" stroke="none"
      >end compute_caldyn_vert</text
      ><rect x="10" y="806" fill="none" width="199" rx="24" ry="16" height="24" stroke="rgb(51,51,51)"
      /><line y2="814" fill="none" x1="10" x2="10" stroke="rgb(51,51,51)" y1="26"
    /></g
  ></g
></svg
>
