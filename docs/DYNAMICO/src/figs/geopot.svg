<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xml:space="preserve"
   width="1322.79"
   font-size="12px"
   viewBox="0 0 1322.79 884"
   stroke-miterlimit="10"
   font-style="normal"
   height="884"
   font-weight="normal"
   id="svg2"
   version="1.1"
   inkscape:version="0.91 r13725"
   sodipodi:docname="geopot.svg"
   style="font-style:normal;font-weight:normal;font-size:12px;font-family:Dialog;color-interpolation:auto;fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto"><metadata
     id="metadata265"><rdf:RDF><cc:Work
         rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><sodipodi:namedview
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="946"
     inkscape:window-height="480"
     id="namedview263"
     showgrid="false"
     fit-margin-top="0"
     fit-margin-left="0"
     fit-margin-right="0"
     fit-margin-bottom="0"
     inkscape:zoom="0.2616408"
     inkscape:cx="669.5"
     inkscape:cy="442"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="0"
     inkscape:current-layer="svg2" /><!--Generated by the Batik Graphics2D SVG Generator--><defs
     id="genericDefs" /><g
     id="g5"
     transform="translate(-9,-9)"><g
       font-size="14px"
       id="g7"
       style="font-size:14px;font-family:sans-serif;fill:#ffffff;stroke:#ffffff;stroke-width:2;text-rendering:geometricPrecision"><rect
         x="10"
         y="10"
         width="317"
         rx="24"
         ry="16"
         height="24"
         id="rect9"
         style="stroke:none" /><text
         x="25"
         xml:space="preserve"
         y="28"
         id="text11"
         style="fill:#333333;stroke:none">compute_geopot(ps,rhodz,theta, pk,geopot)</text>
<rect
         x="10"
         y="10"
         width="317"
         rx="24"
         ry="16"
         height="24"
         id="rect13"
         style="fill:none;stroke:#333333" /><text
         x="305.53909"
         xml:space="preserve"
         y="62"
         id="text15"
         style="fill:#333333;stroke:none">(Compute exner function and geopotential)</text>
<rect
         x="617.34082"
         width="310.58789"
         height="24"
         y="78"
         id="rect17"
         style="stroke:none" /><text
         x="632.34082"
         xml:space="preserve"
         y="96"
         id="text19"
         style="fill:#333333;stroke:none">p_ik = ptop + mass_ak(l) + mass_bk(l)*ps(ij)</text>
<rect
         x="617.34082"
         width="310.58789"
         height="24"
         y="78"
         id="rect21"
         style="fill:none;stroke:#333333" /><rect
         x="617.34082"
         width="269.99609"
         height="24"
         y="112"
         id="rect23"
         style="stroke:none" /><text
         x="632.34082"
         xml:space="preserve"
         y="130"
         id="text25"
         style="fill:#333333;stroke:none">exner_ik = cpp * (p_ik/preff) ** kappa</text>
<rect
         x="617.34082"
         width="269.99609"
         height="24"
         y="112"
         id="rect27"
         style="fill:none;stroke:#333333" /><rect
         x="617.34082"
         width="141.13181"
         height="24"
         y="146"
         id="rect29"
         style="stroke:none" /><text
         x="632.34082"
         xml:space="preserve"
         y="164"
         id="text31"
         style="fill:#333333;stroke:none">pk(ij,l) = exner_ik</text>
<rect
         x="617.34082"
         width="141.13181"
         height="24"
         y="146"
         id="rect33"
         style="fill:none;stroke:#333333" /><text
         x="632.34082"
         xml:space="preserve"
         y="198"
         id="text35"
         style="fill:#333333;stroke:none">(specific volume v = kappa*theta*pi/p = dphi/g/rhodz)</text>
<rect
         x="617.34082"
         width="507.60641"
         height="24"
         y="214"
         id="rect37"
         style="stroke:none" /><text
         x="632.34082"
         xml:space="preserve"
         y="232"
         id="text39"
         style="fill:#333333;stroke:none">geopot(ij,l+1) = geopot(ij,l) + (g*kappa)*rhodz(ij,l)*theta(ij,l)*exner_ik/p_ik</text>
<rect
         x="617.34082"
         width="507.60641"
         height="24"
         y="214"
         id="rect41"
         style="fill:none;stroke:#333333" /><line
         y2="238"
         x1="617.34082"
         x2="617.34082"
         y1="78"
         id="line43"
         style="fill:none;stroke:#333333" /><line
         y2="78"
         x1="602.34082"
         x2="617.34082"
         y1="78"
         id="line45"
         style="fill:none;stroke:#333333" /><rect
         x="397.9707"
         width="204.3701"
         height="24"
         y="78"
         id="rect47"
         style="stroke:none" /><text
         x="422.9707"
         xml:space="preserve"
         y="96"
         id="text49"
         style="fill:#333333;stroke:none">ij=ij_begin_ext,ij_end_ext</text>
<rect
         x="397.9707"
         width="204.3701"
         height="24"
         y="78"
         id="rect51"
         style="fill:none;stroke:#333333" /><line
         y2="102"
         x1="407.9707"
         x2="407.9707"
         y1="78"
         id="line53"
         style="fill:none;stroke:#333333" /><line
         y2="78"
         x1="382.9707"
         x2="397.9707"
         y1="78"
         id="line55"
         style="fill:none;stroke:#333333" /><rect
         x="290.53909"
         width="92.431602"
         height="24"
         y="78"
         id="rect57"
         style="stroke:none" /><text
         x="315.53909"
         xml:space="preserve"
         y="96"
         id="text59"
         style="fill:#333333;stroke:none">l = 1,llm</text>
<rect
         x="290.53909"
         width="92.431602"
         height="24"
         y="78"
         id="rect61"
         style="fill:none;stroke:#333333" /><line
         y2="102"
         x1="300.53909"
         x2="300.53909"
         y1="78"
         id="line63"
         style="fill:none;stroke:#333333" /><line
         y2="102"
         x1="290.53909"
         x2="290.53909"
         y1="44"
         id="line65"
         style="fill:none;stroke:#333333" /><line
         y2="44"
         x1="275.53909"
         x2="290.53909"
         y1="44"
         id="line67"
         style="fill:none;stroke:#333333" /><text
         x="305.53909"
         xml:space="preserve"
         y="266"
         id="text69"
         style="fill:#333333;stroke:none">(We are using a Lagrangian vertical coordinate </text>
<text
         x="305.53909"
         xml:space="preserve"
         y="280"
         id="text71"
         style="fill:#333333;stroke:none">Pressure must be computed first top-down (temporarily stored in pk) </text>
<text
         x="305.53909"
         xml:space="preserve"
         y="294"
         id="text73"
         style="fill:#333333;stroke:none">Then Exner pressure and geopotential are computed bottom-up)</text>
<text
         x="305.53909"
         xml:space="preserve"
         y="328"
         id="text75"
         style="fill:#333333;stroke:none">(Notice that the computation below should work also when caldyn_eta=eta_mass)</text>
<text
         x="511.38181"
         xml:space="preserve"
         y="362"
         id="text77"
         style="fill:#333333;stroke:none">(compute only geopotential :</text>
<text
         x="511.38181"
         xml:space="preserve"
         y="376"
         id="text79"
         style="fill:#333333;stroke:none"> pressure pk will be computed in compute_caldyn_horiz </text>
<text
         x="511.38181"
         xml:space="preserve"
         y="390"
         id="text81"
         style="fill:#333333;stroke:none"> specific volume 1 = dphi/g/rhodz)</text>
<rect
         x="823.18359"
         width="296.31451"
         height="24"
         y="406"
         id="rect83"
         style="stroke:none" /><text
         x="838.18359"
         xml:space="preserve"
         y="424"
         id="text85"
         style="fill:#333333;stroke:none">geopot(ij,l+1) = geopot(ij,l) + g*rhodz(ij,l)</text>
<rect
         x="823.18359"
         width="296.31451"
         height="24"
         y="406"
         id="rect87"
         style="fill:none;stroke:#333333" /><line
         y2="406"
         x1="808.18359"
         x2="823.18359"
         y1="406"
         id="line89"
         style="fill:none;stroke:#333333" /><rect
         x="603.81348"
         width="204.3701"
         height="24"
         y="406"
         id="rect91"
         style="stroke:none" /><text
         x="628.81348"
         xml:space="preserve"
         y="424"
         id="text93"
         style="fill:#333333;stroke:none">ij=ij_begin_ext,ij_end_ext</text>
<rect
         x="603.81348"
         width="204.3701"
         height="24"
         y="406"
         id="rect95"
         style="fill:none;stroke:#333333" /><line
         y2="430"
         x1="613.81348"
         x2="613.81348"
         y1="406"
         id="line97"
         style="fill:none;stroke:#333333" /><line
         y2="406"
         x1="588.81348"
         x2="603.81348"
         y1="406"
         id="line99"
         style="fill:none;stroke:#333333" /><rect
         x="496.38181"
         width="92.431602"
         height="24"
         y="406"
         id="rect101"
         style="stroke:none" /><text
         x="521.38177"
         xml:space="preserve"
         y="424"
         id="text103"
         style="fill:#333333;stroke:none">l = 1,llm</text>
<rect
         x="496.38181"
         width="92.431602"
         height="24"
         y="406"
         id="rect105"
         style="fill:none;stroke:#333333" /><line
         y2="430"
         x1="506.38181"
         x2="506.38181"
         y1="406"
         id="line107"
         style="fill:none;stroke:#333333" /><line
         y2="430"
         x1="496.38181"
         x2="496.38181"
         y1="344"
         id="line109"
         style="fill:none;stroke:#333333" /><line
         y2="344"
         x1="481.38181"
         x2="496.38181"
         y1="344"
         id="line111"
         style="fill:none;stroke:#333333" /><text
         x="511.38181"
         xml:space="preserve"
         y="458"
         id="text113"
         style="fill:#333333;stroke:none">(non-Boussinesq, compute geopotential and Exner pressure)</text>
<text
         x="511.38181"
         xml:space="preserve"
         y="492"
         id="text115"
         style="fill:#333333;stroke:none">(uppermost layer)</text>
<rect
         x="715.75201"
         width="267.5488"
         height="24"
         y="508"
         id="rect117"
         style="stroke:none" /><text
         x="730.75201"
         xml:space="preserve"
         y="526"
         id="text119"
         style="fill:#333333;stroke:none">pk(ij,llm) = ptop + (.5*g)*rhodz(ij,llm)</text>
<rect
         x="715.75201"
         width="267.5488"
         height="24"
         y="508"
         id="rect121"
         style="fill:none;stroke:#333333" /><line
         y2="508"
         x1="700.75201"
         x2="715.75201"
         y1="508"
         id="line123"
         style="fill:none;stroke:#333333" /><rect
         x="496.38181"
         width="204.3701"
         height="24"
         y="508"
         id="rect125"
         style="stroke:none" /><text
         x="521.38177"
         xml:space="preserve"
         y="526"
         id="text127"
         style="fill:#333333;stroke:none">ij=ij_begin_ext,ij_end_ext</text>
<rect
         x="496.38181"
         width="204.3701"
         height="24"
         y="508"
         id="rect129"
         style="fill:none;stroke:#333333" /><line
         y2="532"
         x1="506.38181"
         x2="506.38181"
         y1="508"
         id="line131"
         style="fill:none;stroke:#333333" /><text
         x="511.38181"
         xml:space="preserve"
         y="560"
         id="text133"
         style="fill:#333333;stroke:none">(other layers)</text>
<rect
         x="862.10059"
         width="360.4902"
         height="24"
         y="576"
         id="rect135"
         style="stroke:none" /><text
         x="877.10059"
         xml:space="preserve"
         y="594"
         id="text137"
         style="fill:#333333;stroke:none">pk(ij,l) = pk(ij,l+1) + (.5*g)*(rhodz(ij,l)+rhodz(ij,l+1))</text>
<rect
         x="862.10059"
         width="360.4902"
         height="24"
         y="576"
         id="rect139"
         style="fill:none;stroke:#333333" /><line
         y2="576"
         x1="847.10059"
         x2="862.10059"
         y1="576"
         id="line141"
         style="fill:none;stroke:#333333" /><rect
         x="642.73053"
         width="204.3701"
         height="24"
         y="576"
         id="rect143"
         style="stroke:none" /><text
         x="667.73053"
         xml:space="preserve"
         y="594"
         id="text145"
         style="fill:#333333;stroke:none">ij=ij_begin_ext,ij_end_ext</text>
<rect
         x="642.73053"
         width="204.3701"
         height="24"
         y="576"
         id="rect147"
         style="fill:none;stroke:#333333" /><line
         y2="600"
         x1="652.73053"
         x2="652.73053"
         y1="576"
         id="line149"
         style="fill:none;stroke:#333333" /><line
         y2="576"
         x1="627.73053"
         x2="642.73053"
         y1="576"
         id="line151"
         style="fill:none;stroke:#333333" /><rect
         x="496.38181"
         width="131.3486"
         height="24"
         y="576"
         id="rect153"
         style="stroke:none" /><text
         x="521.38177"
         xml:space="preserve"
         y="594"
         id="text155"
         style="fill:#333333;stroke:none">l = llm-1, 1, -1</text>
<rect
         x="496.38181"
         width="131.3486"
         height="24"
         y="576"
         id="rect157"
         style="fill:none;stroke:#333333" /><line
         y2="600"
         x1="506.38181"
         x2="506.38181"
         y1="576"
         id="line159"
         style="fill:none;stroke:#333333" /><text
         x="511.38181"
         xml:space="preserve"
         y="628"
         id="text161"
         style="fill:#333333;stroke:none">(surface pressure (for diagnostics))</text>
<rect
         x="715.75201"
         width="247.0273"
         height="24"
         y="644"
         id="rect163"
         style="stroke:none" /><text
         x="730.75201"
         xml:space="preserve"
         y="662"
         id="text165"
         style="fill:#333333;stroke:none">ps(ij) = pk(ij,1) + (.5*g)*rhodz(ij,1)</text>
<rect
         x="715.75201"
         width="247.0273"
         height="24"
         y="644"
         id="rect167"
         style="fill:none;stroke:#333333" /><line
         y2="644"
         x1="700.75201"
         x2="715.75201"
         y1="644"
         id="line169"
         style="fill:none;stroke:#333333" /><rect
         x="496.38181"
         width="204.3701"
         height="24"
         y="644"
         id="rect171"
         style="stroke:none" /><text
         x="521.38177"
         xml:space="preserve"
         y="662"
         id="text173"
         style="fill:#333333;stroke:none">ij=ij_begin_ext,ij_end_ext</text>
<rect
         x="496.38181"
         width="204.3701"
         height="24"
         y="644"
         id="rect175"
         style="fill:none;stroke:#333333" /><line
         y2="668"
         x1="506.38181"
         x2="506.38181"
         y1="644"
         id="line177"
         style="fill:none;stroke:#333333" /><text
         x="511.38181"
         xml:space="preserve"
         y="696"
         id="text179"
         style="fill:#333333;stroke:none">(specific volume v = kappa*theta*pi/p = dphi/g/rhodz)</text>
<rect
         x="823.18359"
         width="113.4189"
         height="24"
         y="712"
         id="rect181"
         style="stroke:none" /><text
         x="838.18359"
         xml:space="preserve"
         y="730"
         id="text183"
         style="fill:#333333;stroke:none">p_ik = pk(ij,l)</text>
<rect
         x="823.18359"
         width="113.4189"
         height="24"
         y="712"
         id="rect185"
         style="fill:none;stroke:#333333" /><rect
         x="823.18359"
         width="269.99609"
         height="24"
         y="746"
         id="rect187"
         style="stroke:none" /><text
         x="838.18359"
         xml:space="preserve"
         y="764"
         id="text189"
         style="fill:#333333;stroke:none">exner_ik = cpp * (p_ik/preff) ** kappa</text>
<rect
         x="823.18359"
         width="269.99609"
         height="24"
         y="746"
         id="rect191"
         style="fill:none;stroke:#333333" /><rect
         x="823.18359"
         width="507.60641"
         height="24"
         y="780"
         id="rect193"
         style="stroke:none" /><text
         x="838.18359"
         xml:space="preserve"
         y="798"
         id="text195"
         style="fill:#333333;stroke:none">geopot(ij,l+1) = geopot(ij,l) + (g*kappa)*rhodz(ij,l)*theta(ij,l)*exner_ik/p_ik</text>
<rect
         x="823.18359"
         width="507.60641"
         height="24"
         y="780"
         id="rect197"
         style="fill:none;stroke:#333333" /><rect
         x="823.18359"
         width="141.13181"
         height="24"
         y="814"
         id="rect199"
         style="stroke:none" /><text
         x="838.18359"
         xml:space="preserve"
         y="832"
         id="text201"
         style="fill:#333333;stroke:none">pk(ij,l) = exner_ik</text>
<rect
         x="823.18359"
         width="141.13181"
         height="24"
         y="814"
         id="rect203"
         style="fill:none;stroke:#333333" /><line
         y2="838"
         x1="823.18359"
         x2="823.18359"
         y1="712"
         id="line205"
         style="fill:none;stroke:#333333" /><line
         y2="712"
         x1="808.18359"
         x2="823.18359"
         y1="712"
         id="line207"
         style="fill:none;stroke:#333333" /><rect
         x="603.81348"
         width="204.3701"
         height="24"
         y="712"
         id="rect209"
         style="stroke:none" /><text
         x="628.81348"
         xml:space="preserve"
         y="730"
         id="text211"
         style="fill:#333333;stroke:none">ij=ij_begin_ext,ij_end_ext</text>
<rect
         x="603.81348"
         width="204.3701"
         height="24"
         y="712"
         id="rect213"
         style="fill:none;stroke:#333333" /><line
         y2="736"
         x1="613.81348"
         x2="613.81348"
         y1="712"
         id="line215"
         style="fill:none;stroke:#333333" /><line
         y2="712"
         x1="588.81348"
         x2="603.81348"
         y1="712"
         id="line217"
         style="fill:none;stroke:#333333" /><rect
         x="496.38181"
         width="92.431602"
         height="24"
         y="712"
         id="rect219"
         style="stroke:none" /><text
         x="521.38177"
         xml:space="preserve"
         y="730"
         id="text221"
         style="fill:#333333;stroke:none">l = 1,llm</text>
<rect
         x="496.38181"
         width="92.431602"
         height="24"
         y="712"
         id="rect223"
         style="fill:none;stroke:#333333" /><line
         y2="736"
         x1="506.38181"
         x2="506.38181"
         y1="712"
         id="line225"
         style="fill:none;stroke:#333333" /><line
         y2="736"
         x1="496.38181"
         x2="496.38181"
         y1="440"
         id="line227"
         style="fill:none;stroke:#333333" /><line
         y2="440"
         x1="481.38181"
         x2="496.38181"
         y1="440"
         id="line229"
         style="fill:none;stroke:#333333" /><polygon
         points="481,440 290,440 290,344 481,344 441,392 "
         id="polygon231"
         style="stroke:none" /><text
         x="422.60159"
         xml:space="preserve"
         y="362"
         id="text233"
         style="fill:#333333;stroke:none" />
<text
         x="418.82129"
         xml:space="preserve"
         y="434"
         id="text235"
         style="fill:#333333;stroke:none" />
<text
         x="305.53909"
         xml:space="preserve"
         y="398"
         id="text237"
         style="fill:#333333;stroke:none">(boussinesq)</text>
<polygon
         points="481,440 290,440 290,344 481,344 441,392 "
         id="polygon239"
         style="fill:none;stroke:#333333" /><line
         y2="440"
         x1="290.53909"
         x2="290.53909"
         y1="248"
         id="line241"
         style="fill:none;stroke:#333333" /><line
         y2="248"
         x1="275.53909"
         x2="290.53909"
         y1="248"
         id="line243"
         style="fill:none;stroke:#333333" /><polygon
         points="275,248 10,248 10,44 275,44 235,146 "
         id="polygon245"
         style="stroke:none" /><text
         x="216.7588"
         xml:space="preserve"
         y="62"
         id="text247"
         style="fill:#333333;stroke:none" />
<text
         x="212.9785"
         xml:space="preserve"
         y="242"
         id="text249"
         style="fill:#333333;stroke:none" />
<text
         x="25"
         xml:space="preserve"
         y="152"
         id="text251"
         style="fill:#333333;stroke:none">(caldyn_eta==eta_mass)</text>
<polygon
         points="275,248 10,248 10,44 275,44 235,146 "
         id="polygon253"
         style="fill:none;stroke:#333333" /><rect
         x="10"
         y="868"
         width="141"
         rx="24"
         ry="16"
         height="24"
         id="rect255"
         style="stroke:none" /><text
         x="25"
         xml:space="preserve"
         y="886"
         id="text257"
         style="fill:#333333;stroke:none">compute_geopot</text>
<rect
         x="10"
         y="868"
         width="141"
         rx="24"
         ry="16"
         height="24"
         id="rect259"
         style="fill:none;stroke:#333333" /><line
         y2="876"
         x1="10"
         x2="10"
         y1="26"
         id="line261"
         style="fill:none;stroke:#333333" /></g></g></svg>